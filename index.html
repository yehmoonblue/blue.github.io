<!DOCTYPE html>
<html>
  <head>
    <link href = "css/bootstrap.css" rel="stylesheet">
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/yehmoonblue/blue.github.io/master/picture/icon.png" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/fdb-all.html"> </script>
  </head>

  <body>
    <nav class="navbar navbar-default">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#"></a></li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">工具 <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#" class = "#">ㄎㄎ</a></li>
            <li><a href="#" class = "#">喔喔~</a></li>
            <li><a href="#" class = "#">哈哈</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#" class = "#">Ya~</a></li>
          </ul>
        </li>
      </ul>
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">日誌~</a>
        </div>
        <div class="collapse navbar-collapse navbar-collapse-center" id="myNavbar">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">首頁</a></li>
            <li><a href="#">Page 1</a></li>
            <li><a href="#">Page 2</a></li>
            <li><a href="#">Page 3</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class= "container">
      <h4>這是某天的日誌~</h4>
      <div class= "row">
        <div class= "col-md-4 col-xs-12"></div>
        <div class= "col-md-8 col-xs-12"></div>
        <div class= "col-md-12 col-xs-12"></div>
      </div>
    </div>
    <h2>Hellow~</h2>
    <h2>今天久違的再次寫html和css，然而寫了開頭就不知道要寫什麼了......<p>讓人頭痛啊～<p>html和css差不多都忘光了，真是沒力啊～<p>總之就是回想～</h2>
    <h2>然而並沒有什麼用處。<p>外加自己的電腦鬧彆扭，不讓我上網，更加的沒力......<p>然後我發現光打這些內容並讓他顯示出來竟然讓我花了快</h2>
    <h1>2個小時！</h1>
    <h2>崩潰。<p>後來又在外加了些工具和修改內容......<p>時間一直飛<p>真是讓人無力啊~</h2>
    <img src="picture/ios-7-symbol-nożyczek_318-34277.jpg"><br>
    <button id="eee" type="button" class="btn btn-default" onclick="showitem()">顯示資料</button>
    名字<input type="checkbox" id="mu" value="名字">
    年齡<input type="checkbox" id="mu" value="年齡">
    <button id="sera" type="button" class="btn btn-default" onclick="str">咻咻</button>
    <input id="sm" type="number">
    <input id="bg" type="number">
    <button id="search" type="button" class="btn btn-default" onclick="look()">尋找</button>
    <table id="table1" class="table table-hover" type="button">
      <thead>
        <tr>
          <td>name</td>
          <td>age</td>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <div>
      <div class="newComment">
        <br>
        姓名:<br>
        <input id="name2" type="text"><br>
        年齡:<br>
        <input id="age2" type="text"><br>
        老師:<br>
        <select id="teacher">
          <option value="0">---請選擇老師---</option>
        </select>
        <button id="new" type="button" class="btn btn-default" onclick="additem()">新增</button><br>
      </div> 
    </div>
    <div>
    <br>
      老師:<input id="teacher"><br>
      <button id="newteacher" type="button" class="btn btn-default" onclick="addCategory()">新增老師</button><br>
    </div>
    
  
    <div class="modal fade" role="dialog" id='hahaha'>
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">id的詳細資料</h4>
          </div>
          <div class="modal-body">
            <p id='searchresult'></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    
    
    <div class="modal fade" role="dialog" id='hahahaha'>
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">更新資料</h4>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="editName">姓名</label>
                <input type="text" class="form-control" id="editName">
              </div>
              <div class="form-group">
                <label for="editAge">年齡</label>
                <input type="text" class="form-control" id="editAge">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">關閉</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="editItem()">儲存</button>
          </div>
        </div>
      </div>
    </div>
  
  
  
  </body>

  
  <script>
    var fdb = new ForerunnerDB();
    var db = fdb.db("shop");
    var editDataId;
    studentCollection = db.collection('articles');
    teacherCollection = db.collection('xlg');
    studentCollection.load();  
    teacherCollection.load();
    $("div#comment").hide();
  
    function showitem(){
      $("#newteacher").hide();
      $("tbody").text("");
      $("div#comment").show();
      var teach = ""
      for(var i=0;i<studentCollection.find().length;i++){
        var tata={
        _id: studentCollection.find()[i].teacherid
        };
        console.log(tata._id)
        if(tata._id!=undefined){
        teacherName = teacherCollection.find(tata)[0].teachername
        }else{
        teacherName = "沒有老師。"
        }
        var commentdata="<tr><td>"+studentCollection.find()[i].name+"</td><td>"+studentCollection.find()[i].age+"</td><td>"+teacherName+"</td></tr>"
        var searchdata="<tr><td><a id='items' data-toggle='modal' data-target='#hahaha'>"+studentCollection.find()[i]._id+"</a></td><td><button id='deleteitem' type='button' class='btn btn-default' data-id='"+studentCollection.find()[i]._id+"'>刪除</button><button id='editItem' class='btn btn-primary' data-id='"+studentCollection.find()[i]._id+"'>編輯</button></td></tr>"
        $("table1#commenttable tbody").append(commentdata);
        $("table1#idtable tbody").append(searchdata);
        console.log(999);
      };
      for(var i=0;i<teacherCollection.find().length;i++){
        var optiondata = "<option value='"+teacherCollection.find()[i]._id+"'>"+teacherCollection.find()[i].teachername+"</option>"
        $("select#tata").append(optiondata);
      }
    };
    

    
    
    function additem(){
      studentCollection.insert({
        name: $("input#name").val(),
        age: $("input#age").val(),
        teacherid: $("select#teacher :selected").val()
      });
      studentCollection.save()
      showitem();
      alert(JSON.stringify(studentCollection.find()));
    }
    
    function addCategory(){
      teacherCollection.insert({
        teachername: $("input#teacher").val()
      });
      teacherCollection.save()
      showitem();
      alert(JSON.stringify(teacherCollection.find()));
    }
    
  
    function searchdetail(){
      var id =$(this).text();
      var query = {
        _id: id
      };
      console.log(id);
      $("p#searchresult").text(JSON.stringify(studentCollection.find(query)[0]));
    };
    
    
    function look(){
      if($("#sm").val()!=""){
        var result = studentCollection.find({
          age: {
            "$gt":$("#bg").val()/1,
            "$lt":$("#sm").val()/1
          }
        });
        console.log(result[0].age);
        for(var i=0;i<result.length;i++){
          $("p#look").append("age:"+result[i].age+ "name:"+result[i].name+ "<br>")
        }
        $('#hahaha').modal();
      }else{
        var result = studentCollection.find({
          age:{
            "$gt":$("#bg").val()/1
          }
        });
        $("p#searchresult").text(""); 
        for(var i=0;i<result.length;i++){
          $("p#searchresult").append("name:"+result[i].name+ "age:"+result[i].age+ "<br>")
        }
        $('#hahaha').modal();
        console.log(result[0].age);
      }}
    
    
    function str(){
      var checkList = []
      if($("#mu:checked").length>0){
        for(var i=0; i<$("#mu:checked").length; i++){
          checkList.push($("#mu:checked")[i].value)
        }
        var result = studentCollection.find({
          name:{
          $in: checkList
          }
        });
        $("p#searchresult").text(""); 
        for(var i=0;i<result.length;i++){
          $("p#searchresult").append("name:"+result[i].name+ "age:"+result[i].age+"<br>")
        }
        $('#hahaha').modal();
      }else{
        alert("你沒選")
      }
    }
    
    function deleteitem(){
      var id = $(this).data("id");
      console.log(id)
      var r=confirm("你確定要刪掉嗎？")
      if(r){
        studentCollection.remove({
          _id:id
        });  
        studentCollection.save();
        showitem();
      }else{
        alert("你沒有刪掉");
        console.log(777);
      }}
    
     function editModal(){
      editDataId = $(this).data("id");
      var query={
        _id: editDataId
      }
      $("input#editName").val(studentCollection.find(query)[0].name);
      $("input#editAge").val(studentCollection.find(query)[0].age);
      $("input#Teacher").val(studentCollection.find(query)[0].teacher);
    }
    
    
     function editItem(){
      var newData = {
        name: $("input#editName").val(),
        age: $("input#editAge").val(),
        
      };
      var r=confirm("確定嗎?")
      if(r){
        studentCollection.updateById(editDataId,newData);
        studentCollection.save();
      }else{
        alert("你沒更改。");
      }}
  

    
   
    
  
    $("table").on("click","button#deleteitem",deleteitem);
    $("table").on("click","a#items",searchdetail);
    $("table").on("click","button#edititem",editModal);

  
  
  
  
  </script>
</html>
